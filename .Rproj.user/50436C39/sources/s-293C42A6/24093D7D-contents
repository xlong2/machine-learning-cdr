# figure of comparing RMSD of templates belonging to wrong clusters vs that of enforcing templates to be the right clusters
all_corrected_ones=lapply(enforcing_correct_rmsd_list,function(x){this=do.call(rbind,x)
  
  })
all_corrected_ones=all_corrected_ones[!unlist(lapply(all_corrected_ones,is.null))]
all_corrected_ones_annot=lapply(names(all_corrected_ones),function(x){
  g=all_corrected_ones[[x]]
g=g[!grepl("none",g$X1),];  a=dim(g)[1]
  g$loop_type=rep(x,a); return(g) }); 
names(all_corrected_ones_annot)=names(all_corrected_ones)
write_list_into_single_csv(all_corrected_ones_annot,"./proline_classifier/Data_processed/wrong_template_rmsd_vs_correct_rmsd.csv")


all_corrected_ones_annot_combined=do.call(rbind, all_corrected_ones_annot)
annot_combined <- melt(all_corrected_ones_annot_combined, id.vars=colnames(all_corrected_ones_annot_combined)[!colnames(all_corrected_ones_annot_combined) %in%c("rmsd","correct_cluster_rmsd")])
annot_combined$value=as.numeric(annot_combined$value)
annot_combined_sub=annot_combined[c(1:20,120:150,1000:1200),]
annot_combined_sub$value=as.numeric(annot_combined_sub$value)
annot_combined$loop=sapply(strsplit(annot_combined$loop_type,"_"),"[[",1)
annot_combined$loop_length=sapply(strsplit(annot_combined$loop_type,"_"),"[[",2)
the_ordered=lapply(split(annot_combined$loop_type,annot_combined$loop),function(x){
  a=unique(x);
  the_order=order(as.numeric(sapply(strsplit(a,"_"),"[[",2)));
  ordered_a=a[the_order]
  })
annot_combined$loop_type=factor(annot_combined$loop_type,levels=unlist(the_ordered))


the_plot=ggplot(annot_combined,
       aes(
         x = loop_length,
         y = value,fill=variable
       ))+ geom_boxplot() + facet_grid(~loop_type,scales="free") +
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5),legend.position = c(0.9,0.9))+scale_y_continuous(breaks = 1:15)
options(digits = 2)
ggsave(the_plot,width=6.27, height=6.27, file="./proline_classifier/Plots/blindBLAST_besthit_vs_blast_correct_hit.pdf")
